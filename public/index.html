<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#22c55e">
  <title data-i18n="title">Tax Genius Pro - Get Up To $7,000 Tax Advance</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --green-500: #22c55e;
  --green-600: #16a34a;
  --yellow-400: #facc15;
  --yellow-900: #713f12;
  --foreground: #0f172a;
  --muted-foreground: #64748b;
  --background: #f8fafc;
  --card: #ffffff;
  --border: #e2e8f0;
  --input-border: #cbd5e1;
  --muted: #f1f5f9;
  --red-500: #ef4444;
  --red-50: #fef2f2;
}
html {
  scroll-behavior: smooth;
  -webkit-text-size-adjust: 100%;
}
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--background);
  color: var(--foreground);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Header - matches TaxGeniusPro */
.header {
  padding: 16px;
  border-bottom: 1px solid var(--border);
  background: var(--card);
}
.header-inner {
  max-width: 900px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.logo-img { height: 40px; width: auto; }
.trust-badges {
  display: none;
  gap: 8px;
  font-size: 12px;
  color: var(--muted-foreground);
}
@media (min-width: 480px) {
  .trust-badges { display: flex; }
}

/* Hero Section - matches TaxGeniusPro exactly */
.hero {
  position: relative;
  padding: 32px 16px 48px;
  text-align: center;
  overflow: hidden;
  background: var(--background);
}
.hero::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05), transparent);
  z-index: 0;
}
.hero-glow {
  position: absolute;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 384px;
  height: 384px;
  background: rgba(34, 197, 94, 0.2);
  border-radius: 50%;
  filter: blur(100px);
  z-index: 0;
  animation: pulse 4s ease-in-out infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}
.hero-content {
  position: relative;
  z-index: 1;
  max-width: 900px;
  margin: 0 auto;
}

/* Promo Badge - green with lightning icons */
.promo-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--green-500);
  color: white;
  font-size: 14px;
  font-weight: 700;
  padding: 8px 16px;
  border-radius: 9999px;
  margin-bottom: 24px;
  box-shadow: 0 10px 15px -3px rgba(34, 197, 94, 0.3);
}
.promo-badge svg {
  width: 16px;
  height: 16px;
}

/* Main headline */
.hero-headline {
  font-size: 48px;
  font-weight: 900;
  color: var(--foreground);
  margin-bottom: 8px;
  line-height: 1.1;
}
@media (min-width: 640px) {
  .hero-headline { font-size: 60px; }
}
@media (min-width: 1024px) {
  .hero-headline { font-size: 96px; }
}

/* Amount with badge */
.hero-amount-wrapper {
  position: relative;
  display: inline-block;
  margin-bottom: 24px;
}
.hero-amount {
  font-size: 72px;
  font-weight: 900;
  color: var(--green-500);
  line-height: 1;
}
@media (min-width: 640px) {
  .hero-amount { font-size: 96px; }
}
@media (min-width: 1024px) {
  .hero-amount { font-size: 192px; }
}
.advance-badge {
  position: absolute;
  top: -8px;
  right: -16px;
  background: var(--yellow-400);
  color: var(--yellow-900);
  font-size: 12px;
  font-weight: 700;
  padding: 4px 8px;
  border-radius: 9999px;
  transform: rotate(12deg);
}
@media (min-width: 640px) {
  .advance-badge {
    font-size: 14px;
    right: -32px;
  }
}

/* Features text */
.hero-features-text {
  font-size: 18px;
  color: var(--muted-foreground);
  margin-bottom: 24px;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}
@media (min-width: 640px) {
  .hero-features-text { font-size: 24px; }
}
.hero-features-text .highlight {
  color: var(--foreground);
  font-weight: 600;
}

/* Preparer Card - matches TaxGeniusPro */
.preparer-card {
  background: var(--card);
  border: 2px solid rgba(34, 197, 94, 0.3);
  border-radius: 16px;
  padding: 16px 20px;
  max-width: 420px;
  margin: 0 auto 32px;
  display: flex;
  align-items: center;
  gap: 16px;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}
.preparer-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--muted-foreground);
  text-align: center;
  margin-bottom: 12px;
}
.preparer-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid rgba(34, 197, 94, 0.3);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}
@media (min-width: 640px) {
  .preparer-avatar {
    width: 96px;
    height: 96px;
  }
}
.preparer-details {
  flex: 1;
  text-align: left;
}
.preparer-name {
  font-weight: 700;
  font-size: 20px;
  color: var(--foreground);
  margin-bottom: 2px;
}
@media (min-width: 640px) {
  .preparer-name { font-size: 24px; }
}
.preparer-title {
  font-size: 12px;
  color: var(--muted-foreground);
  margin-bottom: 8px;
}
.preparer-phone {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--green-500);
  color: white;
  padding: 8px 16px;
  border-radius: 9999px;
  font-size: 14px;
  font-weight: 700;
  text-decoration: none;
  box-shadow: 0 4px 6px -1px rgba(34, 197, 94, 0.3);
  transition: box-shadow 0.2s;
}
.preparer-phone:hover {
  box-shadow: 0 10px 15px -3px rgba(34, 197, 94, 0.4);
}
.preparer-phone svg {
  width: 16px;
  height: 16px;
}

/* Form Section - gray background like TaxGeniusPro */
.form-section {
  padding: 32px 16px 48px;
  background: rgba(0, 0, 0, 0.03);
}
.form-container {
  max-width: 420px;
  margin: 0 auto;
}

/* Toggle Buttons - matches TaxGeniusPro */
.toggle-container {
  display: flex;
  background: rgba(0, 0, 0, 0.05);
  border-radius: 8px;
  padding: 4px;
  margin-bottom: 24px;
}
.toggle-btn {
  flex: 1;
  padding: 14px 16px;
  border: none;
  background: transparent;
  font-size: 14px;
  font-weight: 600;
  color: var(--muted-foreground);
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s;
  font-family: inherit;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
.toggle-btn:hover { color: var(--foreground); }
.toggle-btn.active {
  background: var(--green-500);
  color: white;
  box-shadow: 0 4px 6px -1px rgba(34, 197, 94, 0.3);
}

/* Form Card - white with green header */
.form-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}
.form-card-header {
  background: linear-gradient(to right, #22c55e, #16a34a);
  padding: 16px;
  text-align: center;
}
.form-card-header h2 {
  font-size: 20px;
  font-weight: 700;
  color: white;
  margin-bottom: 4px;
}
.form-card-header p {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.9);
}
.form-card-body {
  padding: 24px;
}

/* Progress Bar - only for full intake */
.progress-container {
  padding: 16px;
  background: var(--card);
  border-bottom: 1px solid var(--border);
  display: none;
}
.progress-container.show { display: block; }
.progress-inner {
  max-width: 900px;
  margin: 0 auto;
}
.progress-bar {
  height: 8px;
  background: var(--muted);
  border-radius: 4px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: var(--green-500);
  border-radius: 4px;
  transition: width 0.3s ease;
  width: 0%;
}
.progress-text {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: var(--muted-foreground);
  margin-top: 8px;
}

/* Form Steps */
.form-step {
  display: none;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}
.form-step.active { display: block; }
.step-header {
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border);
}
.step-header h2 {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 4px;
}
.step-header p {
  font-size: 14px;
  color: var(--muted-foreground);
}

/* Form Elements */
.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
@media (max-width: 500px) {
  .form-row { grid-template-columns: 1fr; }
}
.form-group {
  margin-bottom: 16px;
}
.form-group.full-width {
  grid-column: 1 / -1;
}
.form-group label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  color: var(--foreground);
  margin-bottom: 4px;
}
.form-group label .required {
  color: var(--red-500);
}
.form-group input,
.form-group select {
  width: 100%;
  height: 48px;
  padding: 0 14px;
  font-size: 16px;
  font-family: inherit;
  border: 1px solid var(--input-border);
  border-radius: 8px;
  background: var(--card);
  color: var(--foreground);
  transition: border-color 0.2s, box-shadow 0.2s;
  -webkit-appearance: none;
  appearance: none;
}
.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--green-500);
  box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
}
.form-group input::placeholder { color: #94a3b8; }
.form-group .helper-text {
  font-size: 12px;
  color: var(--muted-foreground);
  margin-top: 4px;
}

/* Radio/Checkbox Groups */
.radio-group {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 8px;
}
.radio-option {
  flex: 1;
  min-width: 120px;
}
.radio-option input { display: none; }
.radio-option label {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 14px 16px;
  min-height: 48px;
  border: 2px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
  text-align: center;
  -webkit-tap-highlight-color: transparent;
}
.radio-option input:checked + label {
  border-color: var(--green-500);
  background: rgba(34, 197, 94, 0.1);
  color: var(--green-600);
}
.radio-option label:hover {
  border-color: var(--green-500);
}

/* File Upload */
.file-upload-area {
  border: 2px dashed var(--input-border);
  border-radius: 12px;
  padding: 32px 24px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}
.file-upload-area:hover,
.file-upload-area.dragover {
  border-color: var(--green-500);
  background: rgba(34, 197, 94, 0.05);
}
.file-upload-area.has-file {
  border-color: var(--green-500);
  background: rgba(34, 197, 94, 0.05);
}
.file-upload-area input[type="file"] {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}
.file-upload-area .upload-icon {
  width: 48px;
  height: 48px;
  margin: 0 auto 12px;
  color: var(--muted-foreground);
}
.file-upload-area .upload-text {
  font-size: 14px;
  color: var(--muted-foreground);
  margin-bottom: 8px;
}
.file-upload-area .upload-hint {
  font-size: 12px;
  color: var(--muted-foreground);
}
.file-preview-container {
  display: none;
  margin-top: 16px;
}
.file-preview-container.show { display: block; }
.file-preview-img {
  max-width: 200px;
  max-height: 150px;
  border-radius: 8px;
  margin: 0 auto;
  display: block;
}
.file-name-display {
  font-size: 14px;
  color: var(--green-600);
  font-weight: 500;
  margin-top: 8px;
}

/* Upload Area (Step 6) */
.upload-area {
  border: 2px dashed var(--border);
  border-radius: 12px;
  padding: 32px 24px;
  text-align: center;
  transition: all 0.2s;
}
.upload-area:hover,
.upload-area.dragover {
  border-color: var(--green-500);
  background: rgba(34, 197, 94, 0.05);
}
.upload-area.has-file {
  border-color: var(--green-500);
  background: rgba(34, 197, 94, 0.05);
}
.upload-label {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  color: var(--muted-foreground);
}
.upload-label svg {
  color: var(--muted-foreground);
}
.upload-label:hover svg {
  color: var(--green-500);
}
.preview-container img {
  margin-top: 10px;
  border-radius: 8px;
}

/* Buttons */
.btn-row {
  display: flex;
  gap: 12px;
  margin-top: 24px;
}
.btn {
  flex: 1;
  height: 52px;
  min-height: 52px;
  padding: 0 24px;
  font-size: 16px;
  font-weight: 700;
  font-family: inherit;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
.btn-primary {
  background: var(--green-500);
  color: white;
}
.btn-primary:hover:not(:disabled) {
  background: var(--green-600);
}
.btn-secondary {
  background: var(--muted);
  color: var(--foreground);
}
.btn-secondary:hover:not(:disabled) {
  background: var(--border);
}
.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
.btn svg { width: 20px; height: 20px; }

/* Full Width Button */
.btn-full {
  width: 100%;
  height: 48px;
}

/* Error Message */
.error-message {
  background: var(--red-50);
  border: 1px solid #fecaca;
  color: var(--red-500);
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 14px;
  margin-bottom: 16px;
  display: none;
}

/* Checkbox */
.checkbox-group {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 16px;
}
.checkbox-group input[type="checkbox"] {
  width: 24px;
  height: 24px;
  margin-top: 0;
  flex-shrink: 0;
  cursor: pointer;
  accent-color: var(--green-500);
}
.checkbox-group label {
  font-size: 13px;
  color: var(--muted-foreground);
  line-height: 1.5;
  cursor: pointer;
}

/* Secure Badge */
.secure-badge {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  font-size: 12px;
  color: var(--muted-foreground);
  margin-top: 16px;
}
.secure-badge svg { width: 16px; height: 16px; }

/* Footer */
.footer {
  padding: 16px;
  border-top: 1px solid var(--border);
  text-align: center;
  background: var(--card);
}
.footer-links {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 16px;
  font-size: 14px;
  color: var(--muted-foreground);
}
.footer-links a {
  color: var(--muted-foreground);
  text-decoration: none;
}
.footer-links a:hover {
  color: var(--green-500);
  text-decoration: underline;
}

/* Language Toggle */
.lang-toggle {
  display: flex;
  align-items: center;
  gap: 4px;
  background: var(--muted);
  border-radius: 20px;
  padding: 4px;
  font-size: 12px;
  font-weight: 600;
}
.lang-btn {
  padding: 8px 14px;
  border: none;
  background: transparent;
  border-radius: 16px;
  cursor: pointer;
  font-family: inherit;
  font-weight: 600;
  color: var(--muted-foreground);
  transition: all 0.2s;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  min-width: 44px;
}
.lang-btn.active {
  background: var(--green-500);
  color: white;
}
.lang-btn:hover:not(.active) {
  color: var(--foreground);
}

/* Loading Spinner */
.spinner {
  width: 20px;
  height: 20px;
  animation: spin 1s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Hide/Show Forms */
#advanceFormContainer { display: none; }
#fullIntakeFormContainer { display: block; }

/* What Happens Next Section */
.next-steps-section {
  padding: 48px 16px;
  background: var(--card);
  border-top: 1px solid var(--border);
}
.next-steps-container {
  max-width: 900px;
  margin: 0 auto;
}
.section-title {
  font-size: 28px;
  font-weight: 800;
  color: var(--foreground);
  text-align: center;
  margin-bottom: 32px;
}
.steps-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 24px;
}
@media (max-width: 768px) {
  .steps-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}
@media (max-width: 480px) {
  .steps-grid {
    grid-template-columns: 1fr;
  }
}
.step-item {
  text-align: center;
  padding: 24px 16px;
  background: var(--muted);
  border-radius: 12px;
  transition: transform 0.2s, box-shadow 0.2s;
}
.step-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
}
.step-number {
  width: 48px;
  height: 48px;
  background: var(--green-500);
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 800;
  margin: 0 auto 12px;
}
.step-text {
  font-size: 15px;
  font-weight: 600;
  color: var(--foreground);
  line-height: 1.4;
}

/* FAQ Section */
.faq-section {
  padding: 48px 16px;
  background: var(--background);
}
.faq-container {
  max-width: 900px;
  margin: 0 auto;
}
.faq-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 24px;
}
@media (max-width: 640px) {
  .faq-grid {
    grid-template-columns: 1fr;
  }
}
.faq-item {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
}
.faq-question {
  font-size: 16px;
  font-weight: 700;
  color: var(--foreground);
  margin-bottom: 8px;
}
.faq-answer {
  font-size: 14px;
  color: var(--muted-foreground);
  line-height: 1.6;
}

/* Footer Updates */
.footer {
  padding: 24px 16px;
  border-top: 1px solid var(--border);
  background: var(--card);
}
.footer-inner {
  max-width: 900px;
  margin: 0 auto;
  text-align: center;
}
.disclaimer {
  font-size: 11px;
  color: var(--muted-foreground);
  line-height: 1.5;
  margin-bottom: 16px;
}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <img src="https://taxgeniuspro.tax/images/logo-light-theme.png" alt="Tax Genius Pro" class="logo-img">
      <div style="display: flex; align-items: center; gap: 16px;">
        <div class="trust-badges">
          <span data-i18n="irsAuthorized">IRS Authorized</span>
          <span>•</span>
          <span>BBB A+</span>
        </div>
        <div class="lang-toggle">
          <button class="lang-btn active" id="langEN" onclick="setLanguage('en')">EN</button>
          <button class="lang-btn" id="langES" onclick="setLanguage('es')">ES</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Section - matches TaxGeniusPro -->
  <section class="hero">
    <div class="hero-glow"></div>
    <div class="hero-content">
      <!-- Promo Badge with lightning icons -->
      <div class="promo-badge">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/>
        </svg>
        <span data-i18n="promoBadge">LIMITED TIME - PRESEASON 2026</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/>
        </svg>
      </div>

      <!-- Main Headline -->
      <h1 class="hero-headline" data-i18n="heroHeadline">Get Up To</h1>

      <!-- Amount with TAX ADVANCE badge -->
      <div class="hero-amount-wrapper">
        <span class="hero-amount">$7,000</span>
        <span class="advance-badge" data-i18n="advanceBadge">TAX ADVANCE*</span>
      </div>

      <!-- Features text -->
      <p class="hero-features-text" data-i18n="heroFeatures">
        Available starting <span class="highlight">January 2</span> • Fast approval* • File in-person or remotely
      </p>

      <!-- Preparer Card -->
      <p class="preparer-label" data-i18n="contactUs">Contact Us Today</p>
      <div class="preparer-card">
        <img id="preparerAvatar" src="https://res.cloudinary.com/dhktmiigh/image/upload/v1765487894/taxgeniuspro/preparers/preparer_ow.jpg" alt="Tax Preparer" class="preparer-avatar">
        <div class="preparer-details">
          <p class="preparer-name" id="preparerName">Tax Genius Pro</p>
          <p class="preparer-title" id="preparerTitle">Professional Tax Services</p>
          <a href="tel:14046271015" id="preparerPhoneLink" class="preparer-phone">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
            <span id="preparerPhoneText">1 (404) 627-1015</span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Form Section -->
  <section class="form-section">
    <div class="form-container">
      <!-- Toggle Buttons -->
      <div class="toggle-container">
        <button type="button" class="toggle-btn" id="advanceBtn" data-i18n="toggleAdvance">I want an advance</button>
        <button type="button" class="toggle-btn active" id="fileBtn" data-i18n="toggleFile">Just file my taxes</button>
      </div>

      <!-- ===================== -->
      <!-- SIMPLE ADVANCE FORM -->
      <!-- ===================== -->
      <div id="advanceFormContainer">
        <div class="form-card">
          <div class="form-card-header">
            <h2 data-i18n="advFormTitle">Get Your Cash Advance</h2>
            <p data-i18n="advFormSubtitle">Complete your intake to get started</p>
          </div>
          <div class="form-card-body">
            <form id="advanceForm">
              <input type="hidden" id="advRefCode" name="refCode" value="">
              <input type="hidden" name="wantsAdvance" value="true">
              <input type="hidden" id="advLang" name="lang" value="en">

              <div class="form-row">
                <div class="form-group">
                  <label for="advFirstName" data-i18n="firstName">First Name *</label>
                  <input type="text" id="advFirstName" name="firstName" required maxlength="50" data-i18n-placeholder="firstNamePlaceholder" placeholder="John" autocomplete="given-name">
                </div>
                <div class="form-group">
                  <label for="advLastName" data-i18n="lastName">Last Name *</label>
                  <input type="text" id="advLastName" name="lastName" required maxlength="50" data-i18n-placeholder="lastNamePlaceholder" placeholder="Smith" autocomplete="family-name">
                </div>
              </div>

              <div class="form-group">
                <label for="advPhone" data-i18n="phone">Phone Number *</label>
                <input type="tel" id="advPhone" name="phone" required placeholder="(555) 123-4567" autocomplete="tel">
              </div>

              <div class="form-group">
                <label for="advEmail" data-i18n="email">Email</label>
                <input type="email" id="advEmail" name="email" placeholder="john@email.com" autocomplete="email">
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="advZipCode" data-i18n="zipCode">Zip Code *</label>
                  <input type="text" id="advZipCode" name="zipCode" required placeholder="30301" maxlength="5" pattern="[0-9]{5}" autocomplete="postal-code">
                </div>
                <div class="form-group">
                  <label for="advFilingPref" data-i18n="filingPref">Filing Preference</label>
                  <select id="advFilingPref" name="preferredFiling">
                    <option value="remote" data-i18n="remote">Remote</option>
                    <option value="in-person" data-i18n="inPerson">In-Person</option>
                  </select>
                </div>
              </div>

              <div class="checkbox-group">
                <input type="checkbox" id="advConsent" name="consent" required>
                <label for="advConsent" data-i18n="consentText">
                  I agree to be contacted by Tax Genius Pro via phone, text, or email regarding my tax inquiry.
                </label>
              </div>

              <div id="advErrorMessage" class="error-message"></div>

              <button type="submit" id="advSubmitBtn" class="btn btn-primary btn-full">
                <span id="advSubmitText" data-i18n="checkEligibility">CHECK MY ELIGIBILITY</span>
                <span id="advSubmitLoading" style="display: none;">
                  <svg class="spinner" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="31.4 31.4"/></svg>
                  <span data-i18n="submitting">Submitting...</span>
                </span>
              </button>

              <div class="secure-badge">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <span data-i18n="secureBadge">256-bit SSL Encrypted • Your data is secure</span>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- ===================== -->
      <!-- FULL 6-STEP INTAKE FORM -->
      <!-- ===================== -->
      <div id="fullIntakeFormContainer">
        <form id="intakeForm" enctype="multipart/form-data">
          <input type="hidden" id="refCode" name="refCode" value="">
          <input type="hidden" id="intakeLang" name="lang" value="en">

          <!-- STEP 1: Basic Info -->
          <div class="form-step active" id="step1">
            <div class="form-card">
              <div class="form-card-header">
                <h2 data-i18n="fileFormTitle">Start Your Tax Filing</h2>
                <p data-i18n="fileFormSubtitle">Let's start with your basic information</p>
              </div>
              <div class="form-card-body">
                <div class="form-row">
                  <div class="form-group">
                    <label for="firstName">First Name <span class="required">*</span></label>
                    <input type="text" id="firstName" name="firstName" required maxlength="50" placeholder="John" autocomplete="given-name">
                  </div>
                  <div class="form-group">
                    <label for="middleName">Middle Name</label>
                    <input type="text" id="middleName" name="middleName" maxlength="50" placeholder="Michael" autocomplete="additional-name">
                  </div>
                  <div class="form-group">
                    <label for="lastName">Last Name <span class="required">*</span></label>
                    <input type="text" id="lastName" name="lastName" required maxlength="50" placeholder="Smith" autocomplete="family-name">
                  </div>
                </div>

                <div class="form-group">
                  <label for="email">Email <span class="required">*</span></label>
                  <input type="email" id="email" name="email" required placeholder="john@email.com" autocomplete="email">
                </div>

                <div class="form-group">
                  <label for="phone">Phone Number <span class="required">*</span></label>
                  <input type="tel" id="phone" name="phone" required placeholder="(555) 123-4567" autocomplete="tel">
                </div>

                <div class="checkbox-group">
                  <input type="checkbox" id="consent" name="consent" required>
                  <label for="consent">
                    I agree to be contacted by Tax Genius Pro via phone, text, or email regarding my tax inquiry.
                  </label>
                </div>

                <button type="button" class="btn btn-primary btn-full" onclick="nextStep()">
                  CONTINUE
                </button>

                <div class="secure-badge">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                  </svg>
                  Secure & Confidential
                </div>
              </div>
            </div>
          </div>

          <!-- STEP 2: Address -->
          <div class="form-step" id="step2">
            <div class="step-header">
              <h2>Your Address</h2>
              <p>Where do you live?</p>
            </div>

            <div class="form-group">
              <label for="address1">Street Address <span class="required">*</span></label>
              <input type="text" id="address1" name="address1" required placeholder="123 Main Street" autocomplete="address-line1">
            </div>

            <div class="form-group">
              <label for="address2">Apt/Suite/Unit</label>
              <input type="text" id="address2" name="address2" placeholder="Apt 4B" autocomplete="address-line2">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="city">City <span class="required">*</span></label>
                <input type="text" id="city" name="city" required placeholder="Atlanta" autocomplete="address-level2">
              </div>
              <div class="form-group">
                <label for="state">State <span class="required">*</span></label>
                <select id="state" name="state" required autocomplete="address-level1">
                  <option value="">Select State</option>
                  <option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option>
                  <option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option>
                  <option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="FL">Florida</option>
                  <option value="GA" selected>Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option>
                  <option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option>
                  <option value="KS">Kansas</option><option value="KY">Kentucky</option><option value="LA">Louisiana</option>
                  <option value="ME">Maine</option><option value="MD">Maryland</option><option value="MA">Massachusetts</option>
                  <option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option>
                  <option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option>
                  <option value="NV">Nevada</option><option value="NH">New Hampshire</option><option value="NJ">New Jersey</option>
                  <option value="NM">New Mexico</option><option value="NY">New York</option><option value="NC">North Carolina</option>
                  <option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option>
                  <option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="RI">Rhode Island</option>
                  <option value="SC">South Carolina</option><option value="SD">South Dakota</option><option value="TN">Tennessee</option>
                  <option value="TX">Texas</option><option value="UT">Utah</option><option value="VT">Vermont</option>
                  <option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option>
                  <option value="WI">Wisconsin</option><option value="WY">Wyoming</option><option value="DC">Washington DC</option>
                </select>
              </div>
              <div class="form-group">
                <label for="zipCode">Zip Code <span class="required">*</span></label>
                <input type="text" id="zipCode" name="zipCode" required placeholder="30301" maxlength="5" pattern="[0-9]{5}" autocomplete="postal-code">
              </div>
            </div>

            <div class="btn-row">
              <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
              <button type="button" class="btn btn-primary" onclick="nextStep()">
                Continue
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
              </button>
            </div>
          </div>

          <!-- STEP 3: Personal & Filing Info -->
          <div class="form-step" id="step3">
            <div class="step-header">
              <h2 data-i18n="step2Title">Personal Details</h2>
              <p data-i18n="step2Subtitle">Enter your legal information</p>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="dob" data-i18n="dob">Date of Birth *</label>
                <input type="date" id="dob" name="dob" required>
              </div>
              <div class="form-group">
                <label for="ssn" data-i18n="ssn">Social Security # *</label>
                <input type="text" id="ssn" name="ssn" required placeholder="XXX-XX-XXXX" maxlength="11" autocomplete="off">
                <p class="helper-text" data-i18n="ssnFormat">Format: 123-45-6789</p>
              </div>
            </div>

            <div class="form-group">
              <label for="claimedAsDependent" data-i18n="claimedAsDependent">Will anyone be claiming you as a Dependent?</label>
              <select id="claimedAsDependent" name="claimedAsDependent" required>
                <option value="">Select</option>
                <option value="no" data-i18n="no">No</option>
                <option value="yes" data-i18n="yes">Yes</option>
              </select>
            </div>

            <div class="form-group">
              <label for="filingStatus" data-i18n="filingStatus">Filing Status *</label>
              <select id="filingStatus" name="filingStatus" required>
                <option value="" data-i18n="selectState">Select</option>
                <option value="single" data-i18n="single">Single</option>
                <option value="married_joint" data-i18n="marriedJoint">Married Filing Jointly</option>
                <option value="married_separate" data-i18n="marriedSeparate">Married Filing Separately</option>
                <option value="head_household" data-i18n="headHousehold">Head of Household</option>
                <option value="widow">Qualifying Widow(er)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="employmentType" data-i18n="employmentType">Employment Type *</label>
              <select id="employmentType" name="employmentType" required>
                <option value="">Select</option>
                <option value="W2" data-i18n="w2Employee">W-2 (Company Employee)</option>
                <option value="1099" data-i18n="selfEmployed">1099 (Self-Employed)</option>
                <option value="Both" data-i18n="both">Both W-2 & 1099</option>
                <option value="Unemployed">Unemployed</option>
                <option value="Retired">Retired</option>
              </select>
            </div>

            <div class="btn-row">
              <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
              <button type="button" class="btn btn-primary" onclick="nextStep()">
                Continue
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
              </button>
            </div>
          </div>

          <!-- STEP 4: Employment & Dependents -->
          <div class="form-step" id="step4">
            <div class="step-header">
              <h2 data-i18n="step4Title">Tax Information</h2>
              <p data-i18n="step4Subtitle">Tell us about your filing status</p>
            </div>

            <div class="form-group">
              <label for="occupation" data-i18n="occupation">Occupation *</label>
              <input type="text" id="occupation" name="occupation" required data-i18n-placeholder="occupationPlaceholder" placeholder="e.g. Nurse, Teacher, Driver, DSP">
            </div>

            <div class="form-group">
              <label for="inCollege" data-i18n="inCollege">Are you currently in College?</label>
              <select id="inCollege" name="inCollege">
                <option value="no" data-i18n="no">No</option>
                <option value="yes" data-i18n="yes">Yes</option>
              </select>
            </div>

            <div class="form-group">
              <label for="numDependents" data-i18n="numDependents">Number of Dependents</label>
              <select id="numDependents" name="numDependents">
                <option value="0">None</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5+">5+</option>
              </select>
            </div>

            <div class="form-group">
              <label for="dependentsUnder24" data-i18n="dependentsUnder24">Dependents under 24 or disabled?</label>
              <select id="dependentsUnder24" name="dependentsUnder24">
                <option value="no" data-i18n="no">No</option>
                <option value="yes" data-i18n="yes">Yes</option>
              </select>
            </div>

            <div class="form-group">
              <label for="dependentsInCollege" data-i18n="dependentsInCollege">Dependents in College?</label>
              <select id="dependentsInCollege" name="dependentsInCollege">
                <option value="no" data-i18n="no">No</option>
                <option value="yes" data-i18n="yes">Yes</option>
              </select>
            </div>

            <div class="form-group">
              <label for="childCare" data-i18n="childCare">Do you pay for Child Care?</label>
              <select id="childCare" name="childCare">
                <option value="no" data-i18n="no">No</option>
                <option value="yes" data-i18n="yes">Yes</option>
              </select>
            </div>

            <div class="btn-row">
              <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
              <button type="button" class="btn btn-primary" onclick="nextStep()">
                Continue
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
              </button>
            </div>
          </div>

          <!-- STEP 5: Tax Details -->
          <div class="form-step" id="step5">
            <div class="step-header">
              <h2 data-i18n="step5Title">Upload Documents</h2>
              <p data-i18n="step5Subtitle">A few more questions about your taxes</p>
            </div>

            <div class="form-group">
              <label for="hasMortgage" data-i18n="hasMortgage">Do you have a Mortgage?</label>
              <select id="hasMortgage" name="hasMortgage">
                <option value="no" data-i18n="no">No</option>
                <option value="yes" data-i18n="yes">Yes</option>
              </select>
            </div>

            <div class="form-group">
              <label for="deniedEITC" data-i18n="deniedEITC">Have you ever been Denied EITC?</label>
              <select id="deniedEITC" name="deniedEITC">
                <option value="no" data-i18n="no">No</option>
                <option value="yes" data-i18n="yes">Yes</option>
              </select>
            </div>

            <div class="form-group">
              <label for="hasIrsPin" data-i18n="hasIrsPin">Do you have an IRS PIN?</label>
              <select id="hasIrsPin" name="hasIrsPin">
                <option value="no" data-i18n="no">No</option>
                <option value="yes" data-i18n="yes">Yes</option>
              </select>
            </div>

            <div id="irsPinSection" style="display: none;">
              <div class="form-group">
                <label for="irsPin" data-i18n="irsPinNumber">IRS PIN Number</label>
                <input type="text" id="irsPin" name="irsPin" data-i18n-placeholder="irsPinPlaceholder" placeholder="Enter your 6-digit IRS PIN" maxlength="6">
              </div>
            </div>

            <div class="form-group">
              <label for="wantsCashAdvance" data-i18n="wantsCashAdvance">Do you want a Cash Advance on your refund?</label>
              <select id="wantsCashAdvance" name="wantsCashAdvance">
                <option value="no" data-i18n="no">No</option>
                <option value="yes" data-i18n="yes">Yes</option>
              </select>
            </div>

            <div class="btn-row">
              <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
              <button type="button" class="btn btn-primary" onclick="nextStep()">
                Continue
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
              </button>
            </div>
          </div>

          <!-- STEP 6: ID Upload & Submit -->
          <div class="form-step" id="step6">
            <div class="step-header">
              <h2 data-i18n="step6Title">Review & Submit</h2>
              <p data-i18n="step6Subtitle">Please review your information before submitting</p>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="licenseNumber" data-i18n="licenseNumber">License/ID Number *</label>
                <input type="text" id="licenseNumber" name="licenseNumber" placeholder="e.g. VP436157" maxlength="20">
              </div>
              <div class="form-group">
                <label for="licenseExpiration" data-i18n="licenseExpiration">Expiration Date *</label>
                <input type="date" id="licenseExpiration" name="licenseExpiration">
              </div>
            </div>

            <div class="form-group">
              <label data-i18n="idUpload">Driver's License or State ID (Optional)</label>
              <div class="upload-area" id="idUploadArea">
                <input type="file" id="idDocument" name="idDocument" accept="image/*,.pdf" style="display: none;">
                <label for="idDocument" class="upload-label">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 40px; height: 40px; margin-bottom: 10px;">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17,8 12,3 7,8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                  </svg>
                  <span>Click to upload or drag & drop</span>
                  <span style="font-size: 12px; color: var(--muted-foreground);">JPG, PNG, or PDF</span>
                </label>
                <div id="idPreviewContainer" class="preview-container">
                  <img id="idPreview" style="max-width: 200px; max-height: 150px; display: none; margin-top: 10px; border-radius: 8px;">
                  <p id="idFileName" style="margin-top: 8px; font-size: 14px; color: var(--green-600);"></p>
                </div>
              </div>
            </div>

            <div id="errorMessage" class="error-message"></div>

            <div class="btn-row">
              <button type="button" class="btn btn-secondary" onclick="prevStep()">Back</button>
              <button type="submit" id="submitBtn" class="btn btn-primary">
                <span id="submitText">Submit Intake Form</span>
                <span id="submitLoading" style="display: none;">
                  <svg class="spinner" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="31.4 31.4"/></svg>
                  Submitting...
                </span>
              </button>
            </div>

            <div class="secure-badge">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
              256-bit SSL Encrypted • Your data is secure
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- What Happens Next Section -->
  <section class="next-steps-section">
    <div class="next-steps-container">
      <h2 class="section-title">What Happens Next</h2>
      <div class="steps-grid">
        <div class="step-item">
          <div class="step-number">1</div>
          <p class="step-text">We call or text same day</p>
        </div>
        <div class="step-item">
          <div class="step-number">2</div>
          <p class="step-text">Confirm your documents</p>
        </div>
        <div class="step-item">
          <div class="step-number">3</div>
          <p class="step-text">Prepare & e-file</p>
        </div>
        <div class="step-item">
          <div class="step-number">4</div>
          <p class="step-text">Get your money</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Common Questions Section -->
  <section class="faq-section">
    <div class="faq-container">
      <h2 class="section-title">Common Questions</h2>
      <div class="faq-grid">
        <div class="faq-item">
          <h3 class="faq-question">Do I have to get an advance?</h3>
          <p class="faq-answer">No. You can file with Tax Genius Pro with or without an advance.</p>
        </div>
        <div class="faq-item">
          <h3 class="faq-question">How does the $7,000 advance work?</h3>
          <p class="faq-answer">If approved, you receive a portion of your expected refund early. When your IRS refund arrives, it repays the advance automatically.</p>
        </div>
        <div class="faq-item">
          <h3 class="faq-question">When can I get it?</h3>
          <p class="faq-answer">Funds available starting January 2. Most clients receive same-day or next business day.</p>
        </div>
        <div class="faq-item">
          <h3 class="faq-question">What do I need?</h3>
          <p class="faq-answer">W-2s/1099s, valid ID, Social Security card, and bank account info.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-inner">
      <p class="disclaimer">*Advance amounts based on eligibility, IRS acceptance, and bank approval. Not all applicants qualify for the maximum amount. Funding timing varies by bank. 0% APR and $0 loan fees. Tax preparation fees apply.</p>
      <div class="footer-links">
        <a href="https://taxgeniuspro.tax/en/privacy-policy">Privacy Policy</a>
        <span>|</span>
        <a href="https://taxgeniuspro.tax/en/terms">Terms of Service</a>
        <span>|</span>
        <span>© 2025 Tax Genius Pro. All rights reserved. v2</span>
      </div>
    </div>
  </footer>

  <script>
    // =====================
    // TRANSLATIONS (EN/ES)
    // =====================
    const translations = {
      en: {
        title: 'Tax Genius Pro - Get Up To $7,000 Tax Advance',
        irsAuthorized: 'IRS Authorized',
        promoBadge: 'LIMITED TIME - PRESEASON 2026',
        heroHeadline: 'Get Up To',
        advanceBadge: 'TAX ADVANCE*',
        heroFeatures: 'Available starting <span class="highlight">January 2</span> • Fast approval* • File in-person or remotely',
        contactUs: 'Contact Us Today',
        toggleAdvance: 'I want an advance',
        toggleFile: 'Just file my taxes',
        advFormTitle: 'Get Your Cash Advance',
        advFormSubtitle: 'Complete your intake to get started',
        fileFormTitle: 'Start Your Tax Filing',
        fileFormSubtitle: 'Complete your intake to get started',
        firstName: 'First Name *',
        lastName: 'Last Name *',
        firstNamePlaceholder: 'John',
        lastNamePlaceholder: 'Smith',
        phone: 'Phone Number *',
        email: 'Email',
        zipCode: 'Zip Code *',
        filingPref: 'Filing Preference',
        remote: 'Remote',
        inPerson: 'In-Person',
        consentText: 'I agree to be contacted by Tax Genius Pro via phone, text, or email regarding my tax inquiry.',
        checkEligibility: 'CHECK MY ELIGIBILITY',
        startFiling: 'START MY TAX FILING',
        submitting: 'Submitting...',
        secureBadge: '256-bit SSL Encrypted • Your data is secure',
        secureConfidential: 'Secure & Confidential',
        // Step headers
        step2Title: 'Personal Details',
        step2Subtitle: 'Enter your legal information as it appears on your ID',
        step3Title: 'Your Address',
        step3Subtitle: 'Where do you live?',
        step4Title: 'Tax Information',
        step4Subtitle: 'Tell us about your filing status',
        step5Title: 'Upload Documents',
        step5Subtitle: 'Please upload a photo of your ID and any tax documents',
        step6Title: 'Review & Submit',
        step6Subtitle: 'Please review your information before submitting',
        // Form fields
        middleName: 'Middle Name',
        dob: 'Date of Birth *',
        ssn: 'Social Security # *',
        ssnFormat: 'Format: 123-45-6789',
        streetAddress: 'Street Address *',
        aptSuite: 'Apt/Suite/Unit',
        city: 'City *',
        state: 'State *',
        selectState: 'Select State',
        filingStatus: 'Filing Status *',
        single: 'Single',
        marriedJoint: 'Married Filing Jointly',
        marriedSeparate: 'Married Filing Separately',
        headHousehold: 'Head of Household',
        employmentType: 'Employment Type *',
        w2Employee: 'W-2 Employee',
        selfEmployed: '1099 Self-Employed',
        both: 'Both W-2 & 1099',
        occupation: 'Occupation *',
        occupationPlaceholder: 'e.g. Nurse, Teacher, Driver',
        hasDependents: 'Do you have dependents?',
        yes: 'Yes',
        no: 'No',
        numDependents: 'Number of Dependents',
        dependentsUnder24: 'Dependents under 24 or disabled?',
        dependentsInCollege: 'Dependents in College?',
        childCare: 'Do you pay for Child Care?',
        claimedAsDependent: 'Will anyone be claiming you as a Dependent?',
        inCollege: 'Are you currently in College?',
        hasMortgage: 'Do you have a Mortgage?',
        deniedEITC: 'Have you ever been Denied EITC (Earned Income Tax Credit)?',
        hasIrsPin: 'Do you have an IRS PIN?',
        irsPinNumber: 'IRS PIN Number',
        irsPinPlaceholder: 'Enter your 6-digit IRS PIN',
        wantsCashAdvance: 'Do you want a Cash Advance on your refund?',
        // Documents
        idUpload: "Driver's License or State ID (Optional)",
        idUploadText: 'Click or drag to upload your ID',
        idUploadHint: 'JPG, PNG, or PDF up to 10MB',
        licenseNumber: 'License/ID Number *',
        licenseExpiration: 'Expiration Date *',
        taxDocUpload: 'W-2 or Other Tax Documents (Optional)',
        taxDocUploadText: 'Click or drag to upload tax documents',
        taxDocUploadHint: 'W-2, 1099, or other forms',
        // Buttons
        back: 'Back',
        continue: 'Continue',
        submitIntake: 'Submit Intake Form',
        // Footer
        privacyPolicy: 'Privacy Policy',
        termsOfService: 'Terms of Service'
      },
      es: {
        title: 'Tax Genius Pro - Obtenga Hasta $7,000 de Adelanto',
        irsAuthorized: 'Autorizado por el IRS',
        promoBadge: 'TIEMPO LIMITADO - PRETEMPORADA 2026',
        heroHeadline: 'Obtenga Hasta',
        advanceBadge: 'ADELANTO DE IMPUESTOS*',
        heroFeatures: 'Disponible a partir del <span class="highlight">2 de Enero</span> • Aprobación rápida* • Presente en persona o remotamente',
        contactUs: 'Contáctenos Hoy',
        toggleAdvance: 'Quiero un adelanto',
        toggleFile: 'Solo declarar mis impuestos',
        advFormTitle: 'Obtenga Su Adelanto en Efectivo',
        advFormSubtitle: 'Complete su información para comenzar',
        fileFormTitle: 'Comience Su Declaración de Impuestos',
        fileFormSubtitle: 'Complete su información para comenzar',
        firstName: 'Nombre *',
        lastName: 'Apellido *',
        firstNamePlaceholder: 'Juan',
        lastNamePlaceholder: 'García',
        phone: 'Número de Teléfono *',
        email: 'Correo Electrónico',
        zipCode: 'Código Postal *',
        filingPref: 'Preferencia de Presentación',
        remote: 'Remoto',
        inPerson: 'En Persona',
        consentText: 'Acepto ser contactado por Tax Genius Pro por teléfono, mensaje de texto o correo electrónico sobre mi consulta de impuestos.',
        checkEligibility: 'VERIFICAR MI ELEGIBILIDAD',
        startFiling: 'INICIAR MI DECLARACIÓN',
        submitting: 'Enviando...',
        secureBadge: 'Cifrado SSL de 256 bits • Sus datos están seguros',
        secureConfidential: 'Seguro y Confidencial',
        // Step headers
        step2Title: 'Datos Personales',
        step2Subtitle: 'Ingrese su información legal como aparece en su identificación',
        step3Title: 'Su Dirección',
        step3Subtitle: '¿Dónde vive?',
        step4Title: 'Información Fiscal',
        step4Subtitle: 'Cuéntenos sobre su estado de declaración',
        step5Title: 'Subir Documentos',
        step5Subtitle: 'Por favor suba una foto de su identificación y documentos fiscales',
        step6Title: 'Revisar y Enviar',
        step6Subtitle: 'Por favor revise su información antes de enviar',
        // Form fields
        middleName: 'Segundo Nombre',
        dob: 'Fecha de Nacimiento *',
        ssn: 'Número de Seguro Social *',
        ssnFormat: 'Formato: 123-45-6789',
        streetAddress: 'Dirección *',
        aptSuite: 'Apto/Suite/Unidad',
        city: 'Ciudad *',
        state: 'Estado *',
        selectState: 'Seleccione Estado',
        filingStatus: 'Estado de Declaración *',
        single: 'Soltero/a',
        marriedJoint: 'Casado/a Declarando Conjuntamente',
        marriedSeparate: 'Casado/a Declarando por Separado',
        headHousehold: 'Cabeza de Familia',
        employmentType: 'Tipo de Empleo *',
        w2Employee: 'Empleado W-2',
        selfEmployed: 'Trabajador Independiente 1099',
        both: 'Ambos W-2 y 1099',
        occupation: 'Ocupación *',
        occupationPlaceholder: 'ej. Enfermero/a, Maestro/a, Conductor/a',
        hasDependents: '¿Tiene dependientes?',
        yes: 'Sí',
        no: 'No',
        numDependents: 'Número de Dependientes',
        dependentsUnder24: '¿Dependientes menores de 24 años o discapacitados?',
        dependentsInCollege: '¿Dependientes en la Universidad?',
        childCare: '¿Paga por Cuidado de Niños?',
        claimedAsDependent: '¿Alguien lo reclamará como Dependiente?',
        inCollege: '¿Está actualmente en la Universidad?',
        hasMortgage: '¿Tiene Hipoteca?',
        deniedEITC: '¿Le han negado el EITC (Crédito Tributario por Ingreso del Trabajo)?',
        hasIrsPin: '¿Tiene un PIN del IRS?',
        irsPinNumber: 'Número de PIN del IRS',
        irsPinPlaceholder: 'Ingrese su PIN de 6 dígitos del IRS',
        wantsCashAdvance: '¿Desea un Adelanto en Efectivo de su reembolso?',
        // Documents
        idUpload: 'Licencia de Conducir o Identificación Estatal (Opcional)',
        idUploadText: 'Haga clic o arrastre para subir su identificación',
        idUploadHint: 'JPG, PNG o PDF hasta 10MB',
        licenseNumber: 'Número de Licencia/ID *',
        licenseExpiration: 'Fecha de Vencimiento *',
        taxDocUpload: 'W-2 u Otros Documentos Fiscales (Opcional)',
        taxDocUploadText: 'Haga clic o arrastre para subir documentos fiscales',
        taxDocUploadHint: 'W-2, 1099 u otros formularios',
        // Buttons
        back: 'Atrás',
        continue: 'Continuar',
        submitIntake: 'Enviar Formulario',
        // Footer
        privacyPolicy: 'Política de Privacidad',
        termsOfService: 'Términos de Servicio'
      }
    };

    let currentLang = 'en';

    function setLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;

      // Update toggle buttons
      document.getElementById('langEN').classList.toggle('active', lang === 'en');
      document.getElementById('langES').classList.toggle('active', lang === 'es');

      // Update all elements with data-i18n
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang][key]) {
          el.innerHTML = translations[lang][key];
        }
      });

      // Update placeholders
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if (translations[lang][key]) {
          el.placeholder = translations[lang][key];
        }
      });

      // Update hidden lang fields in forms
      const advLangField = document.getElementById('advLang');
      const intakeLangField = document.getElementById('intakeLang');
      if (advLangField) advLangField.value = lang;
      if (intakeLangField) intakeLangField.value = lang;

      // Store preference
      localStorage.setItem('preferredLang', lang);
    }

    // Detect language on load
    function detectLanguage() {
      // 1. Check URL param
      const urlParams = new URLSearchParams(window.location.search);
      const urlLang = urlParams.get('lang');
      if (urlLang === 'es' || urlLang === 'en') return urlLang;

      // 2. Check localStorage
      const storedLang = localStorage.getItem('preferredLang');
      if (storedLang === 'es' || storedLang === 'en') return storedLang;

      // 3. Check browser language
      const browserLang = navigator.language || navigator.userLanguage;
      if (browserLang && browserLang.toLowerCase().startsWith('es')) return 'es';

      return 'en';
    }

    // =====================
    // TOGGLE BETWEEN FORMS
    // =====================
    const advanceBtn = document.getElementById('advanceBtn');
    const fileBtn = document.getElementById('fileBtn');
    const advanceFormContainer = document.getElementById('advanceFormContainer');
    const fullIntakeFormContainer = document.getElementById('fullIntakeFormContainer');
    const progressContainer = document.getElementById('progressContainer');

    advanceBtn.addEventListener('click', () => {
      advanceBtn.classList.add('active');
      fileBtn.classList.remove('active');
      advanceFormContainer.style.display = 'block';
      fullIntakeFormContainer.style.display = 'none';
      progressContainer.classList.remove('show');
    });

    fileBtn.addEventListener('click', () => {
      fileBtn.classList.add('active');
      advanceBtn.classList.remove('active');
      fullIntakeFormContainer.style.display = 'block';
      advanceFormContainer.style.display = 'none';
      progressContainer.classList.add('show');
      updateProgress();
    });

    // =====================
    // REF CODE & PREPARER
    // =====================
    const urlParams = new URLSearchParams(window.location.search);
    const refCode = urlParams.get('ref') || 'ow';
    document.getElementById('refCode').value = refCode;
    document.getElementById('advRefCode').value = refCode;

    async function loadPreparer() {
      try {
        const response = await fetch(`/api/preparer/by-code?code=${encodeURIComponent(refCode)}`);
        const data = await response.json();
        if (data.success && data.preparer) {
          const p = data.preparer;
          document.getElementById('preparerName').textContent = p.fullName;
          document.getElementById('preparerTitle').textContent = p.title;
          document.getElementById('preparerAvatar').src = p.avatarUrl;
          // Update phone number dynamically
          if (p.phone) {
            const phoneDigits = p.phone.replace(/\D/g, '');
            document.getElementById('preparerPhoneLink').href = `tel:${phoneDigits}`;
            document.getElementById('preparerPhoneText').textContent = p.phone;
          }
        }
      } catch (error) {
        console.log('Using default preparer');
      }
    }
    loadPreparer();

    // =====================
    // FULL INTAKE FORM LOGIC
    // =====================
    let currentStep = 1;
    const totalSteps = 6;

    function updateProgress() {
      const percent = Math.round((currentStep / totalSteps) * 100);
      document.getElementById('progressFill').style.width = percent + '%';
      document.getElementById('progressPercent').textContent = percent + '%';
    }

    function showStep(step) {
      document.querySelectorAll('.form-step').forEach((el, i) => {
        el.classList.toggle('active', i + 1 === step);
      });
      currentStep = step;
      updateProgress();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function nextStep() {
      if (validateStep(currentStep) && currentStep < totalSteps) showStep(currentStep + 1);
    }

    function prevStep() {
      if (currentStep > 1) showStep(currentStep - 1);
    }

    function validateStep(step) {
      const stepEl = document.getElementById('step' + step);
      const inputs = stepEl.querySelectorAll('input[required], select[required]');
      let valid = true;
      inputs.forEach(input => {
        if (input.type === 'radio') {
          const checked = stepEl.querySelector(`input[name="${input.name}"]:checked`);
          if (!checked) { valid = false; highlightRadioGroup(input.name); }
        } else if (!input.value.trim()) {
          valid = false;
          input.style.borderColor = 'var(--red-500)';
          setTimeout(() => input.style.borderColor = '', 2000);
        }
      });
      if (!valid) alert('Please fill in all required fields.');
      return valid;
    }

    function highlightRadioGroup(name) {
      document.querySelectorAll(`input[name="${name}"] + label`).forEach(label => {
        label.style.borderColor = 'var(--red-500)';
        setTimeout(() => label.style.borderColor = '', 2000);
      });
    }

    // Phone formatting
    ['phone', 'advPhone'].forEach(id => {
      document.getElementById(id).addEventListener('input', function(e) {
        let v = e.target.value.replace(/\D/g, '');
        if (v.length >= 6) v = `(${v.slice(0,3)}) ${v.slice(3,6)}-${v.slice(6,10)}`;
        else if (v.length >= 3) v = `(${v.slice(0,3)}) ${v.slice(3)}`;
        e.target.value = v;
      });
    });

    // SSN formatting
    document.getElementById('ssn').addEventListener('input', function(e) {
      let v = e.target.value.replace(/\D/g, '');
      if (v.length >= 5) v = `${v.slice(0,3)}-${v.slice(3,5)}-${v.slice(5,9)}`;
      else if (v.length >= 3) v = `${v.slice(0,3)}-${v.slice(3)}`;
      e.target.value = v;
    });

    // IRS PIN toggle (dropdown)
    document.getElementById('hasIrsPin').addEventListener('change', function() {
      document.getElementById('irsPinSection').style.display = this.value === 'yes' ? 'block' : 'none';
    });

    // File upload
    document.getElementById('idDocument').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        document.getElementById('idUploadArea').classList.add('has-file');
        document.getElementById('idFileName').textContent = file.name;
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = e => { document.getElementById('idPreview').src = e.target.result; document.getElementById('idPreview').style.display = 'block'; };
          reader.readAsDataURL(file);
        } else { document.getElementById('idPreview').style.display = 'none'; }
      }
    });

    // Drag and drop for ID upload
    const idArea = document.getElementById('idUploadArea');
    ['dragenter', 'dragover'].forEach(evt => idArea.addEventListener(evt, e => { e.preventDefault(); idArea.classList.add('dragover'); }));
    ['dragleave', 'drop'].forEach(evt => idArea.addEventListener(evt, e => { e.preventDefault(); idArea.classList.remove('dragover'); }));

    // =====================
    // FORM SUBMISSIONS
    // =====================
    document.getElementById('advanceForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const btn = document.getElementById('advSubmitBtn');
      const txt = document.getElementById('advSubmitText');
      const load = document.getElementById('advSubmitLoading');
      const err = document.getElementById('advErrorMessage');
      if (!document.getElementById('advConsent').checked) { err.textContent = 'Please agree to be contacted.'; err.style.display = 'block'; return; }
      btn.disabled = true; txt.style.display = 'none'; load.style.display = 'inline-flex'; err.style.display = 'none';
      const fd = new FormData();
      fd.append('firstName', document.getElementById('advFirstName').value);
      fd.append('lastName', document.getElementById('advLastName').value);
      fd.append('phone', document.getElementById('advPhone').value);
      fd.append('email', document.getElementById('advEmail').value || '');
      fd.append('zipCode', document.getElementById('advZipCode').value);
      fd.append('preferredFiling', document.getElementById('advFilingPref').value);
      fd.append('refCode', document.getElementById('advRefCode').value);
      fd.append('wantsAdvance', 'true');
      fd.append('consent', 'true');
      fd.append('lang', currentLang); // Include language for Telegram routing
      try {
        const res = await fetch('/api/leads', { method: 'POST', body: fd });
        const data = await res.json();
        if (res.ok && data.success) { window.location.href = '/success.html?ref=' + encodeURIComponent(refCode); }
        else { err.textContent = data.details?.join(', ') || data.error || 'Submission failed.'; err.style.display = 'block'; }
      } catch (error) { err.textContent = 'Network error. Please try again.'; err.style.display = 'block'; }
      finally { btn.disabled = false; txt.style.display = 'inline'; load.style.display = 'none'; }
    });

    document.getElementById('intakeForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      const txt = document.getElementById('submitText');
      const load = document.getElementById('submitLoading');
      const err = document.getElementById('errorMessage');
      btn.disabled = true; txt.style.display = 'none'; load.style.display = 'inline-flex'; err.style.display = 'none';
      const fd = new FormData();
      // Text inputs
      ['firstName', 'middleName', 'lastName', 'dob', 'ssn', 'phone', 'email', 'address1', 'address2', 'city', 'state', 'zipCode', 'occupation', 'licenseNumber', 'licenseExpiration', 'irsPin', 'refCode'].forEach(f => {
        const el = document.getElementById(f);
        if (el) fd.append(f, el.value);
      });
      // Dropdown selects
      ['filingStatus', 'employmentType', 'claimedAsDependent', 'inCollege', 'numDependents', 'dependentsUnder24', 'dependentsInCollege', 'childCare', 'hasMortgage', 'deniedEITC', 'hasIrsPin', 'wantsCashAdvance'].forEach(f => {
        const el = document.getElementById(f);
        if (el) fd.append(f, el.value);
      });
      fd.append('wantsAdvance', document.getElementById('wantsCashAdvance')?.value === 'yes' ? 'true' : 'false');
      fd.append('consent', 'true');
      fd.append('lang', currentLang); // Include language for Telegram routing
      // Derive hasDependents from numDependents
      const numDeps = document.getElementById('numDependents')?.value;
      fd.append('hasDependents', numDeps && numDeps !== '0' ? 'yes' : 'no');
      // ID file upload
      const idFile = document.getElementById('idDocument').files[0];
      if (idFile) fd.append('idDocument', idFile);
      try {
        const res = await fetch('/api/leads', { method: 'POST', body: fd });
        const data = await res.json();
        if (res.ok && data.success) { window.location.href = '/success.html?ref=' + encodeURIComponent(refCode); }
        else { err.textContent = data.details?.join(', ') || data.error || 'Submission failed.'; err.style.display = 'block'; }
      } catch (error) { err.textContent = 'Network error. Please try again.'; err.style.display = 'block'; }
      finally { btn.disabled = false; txt.style.display = 'inline'; load.style.display = 'none'; }
    });

    updateProgress();

    // Initialize language on page load
    const detectedLang = detectLanguage();
    if (detectedLang !== 'en') {
      setLanguage(detectedLang);
    }
  </script>
</body>
</html>
